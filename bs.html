<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlockSuite 编辑器示例</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .editor-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .editor-toolbar {
            padding: 12px 16px;
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .toolbar-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .toolbar-btn:hover {
            background: #f0f0f0;
        }
        
        .toolbar-btn.active {
            background: #007acc;
            color: white;
            border-color: #007acc;
        }
        
        .editor-content {
            padding: 20px;
            min-height: 400px;
            outline: none;
        }
        
        .block {
            margin: 8px 0;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .block:hover {
            background-color: #f9f9f9;
        }
        
        .block.selected {
            background-color: #e3f2fd;
            border-left: 3px solid #007acc;
        }
        
        .text-block {
            font-size: 16px;
            line-height: 1.6;
        }
        
        .heading-1 {
            font-size: 24px;
            font-weight: bold;
            margin: 16px 0 8px 0;
        }
        
        .heading-2 {
            font-size: 20px;
            font-weight: bold;
            margin: 12px 0 6px 0;
        }
        
        .list-item {
            margin-left: 20px;
            position: relative;
        }
        
        .list-item::before {
            content: "•";
            position: absolute;
            left: -15px;
            color: #666;
        }
        
        .code-block {
            background: #f4f4f4;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .status-bar {
            padding: 8px 16px;
            background: #fafafa;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="editor-toolbar">
            <button class="toolbar-btn" onclick="formatText('heading-1')">H1</button>
            <button class="toolbar-btn" onclick="formatText('heading-2')">H2</button>
            <button class="toolbar-btn" onclick="formatText('paragraph')">段落</button>
            <button class="toolbar-btn" onclick="formatText('bullet-list')">列表</button>
            <button class="toolbar-btn" onclick="formatText('code')">代码块</button>
            <button class="toolbar-btn" onclick="insertBlock()">插入块</button>
            <button class="toolbar-btn" onclick="exportContent()">导出</button>
        </div>
        
        <div class="editor-content" id="editor" contenteditable="true">
            <div class="block text-block" data-type="paragraph">
                欢迎使用 BlockSuite 编辑器！这是一个现代化的块级编辑器示例。
            </div>
            
            <div class="block heading-1" data-type="heading-1">
                主要特性
            </div>
            
            <div class="block text-block" data-type="paragraph">
                1. 块级编辑：每个元素都是一个独立的块
                2. 实时协作：支持多人同时编辑
                3. 可扩展：易于添加新的块类型
                4. 高性能：虚拟滚动优化
            </div>
            
            <div class="block code-block" data-type="code">
// 示例代码块
function hello() {
    console.log("Hello, BlockSuite!");
}
            </div>
        </div>
        
        <div class="status-bar">
            <span>块数: <span id="block-count">4</span></span>
            <span style="margin-left: 20px;">字数: <span id="word-count">0</span></span>
        </div>
    </div>

    <script>
        // 简化的 BlockSuite 实现
        class BlockSuiteEditor {
            constructor(container) {
                this.container = container;
                this.blocks = [];
                this.selectedBlock = null;
                this.init();
            }
            
            init() {
                this.container.addEventListener('keydown', this.handleKeydown.bind(this));
                this.container.addEventListener('click', this.handleClick.bind(this));
                this.container.addEventListener('input', this.handleInput.bind(this));
                this.updateStats();
            }
            
            handleKeydown(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.insertNewBlock();
                }
                if (e.key === 'Backspace' && window.getSelection().toString() === '') {
                    const block = this.getCurrentBlock();
                    if (block && block.textContent.trim() === '') {
                        e.preventDefault();
                        this.deleteBlock(block);
                    }
                }
            }
            
            handleClick(e) {
                const block = e.target.closest('.block');
                if (block) {
                    this.selectBlock(block);
                }
            }
            
            handleInput(e) {
                this.updateStats();
            }
            
            getCurrentBlock() {
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);
                return range.commonAncestorContainer.closest('.block');
            }
            
            selectBlock(block) {
                document.querySelectorAll('.block').forEach(b => b.classList.remove('selected'));
                block.classList.add('selected');
                this.selectedBlock = block;
            }
            
            insertNewBlock(type = 'paragraph') {
                const newBlock = document.createElement('div');
                newBlock.className = `block ${type}`;
                newBlock.setAttribute('data-type', type);
                newBlock.innerHTML = '<br>';
                
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);
                const currentBlock = range.commonAncestorContainer.closest('.block');
                
                if (currentBlock) {
                    currentBlock.parentNode.insertBefore(newBlock, currentBlock.nextSibling);
                } else {
                    this.container.appendChild(newBlock);
                }
                
                this.selectBlock(newBlock);
                this.setCursor(newBlock);
                this.updateStats();
            }
            
            setCursor(element) {
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(element);
                range.collapse(false);
                selection.removeAllRanges();
                selection.addRange(range);
            }
            
            deleteBlock(block) {
                if (document.querySelectorAll('.block').length > 1) {
                    const prev = block.previousElementSibling || block.nextElementSibling;
                    block.remove();
                    if (prev) {
                        this.selectBlock(prev);
                        this.setCursor(prev);
                    }
                    this.updateStats();
                }
            }
            
            updateStats() {
                const blocks = document.querySelectorAll('.block');
                const words = Array.from(blocks).reduce((count, block) => {
                    return count + (block.textContent || '').trim().split(/\s+/).filter(w => w.length > 0).length;
                }, 0);
                
                document.getElementById('block-count').textContent = blocks.length;
                document.getElementById('word-count').textContent = words;
            }
            
            exportContent() {
                const blocks = Array.from(document.querySelectorAll('.block'));
                const content = blocks.map(block => ({
                    type: block.getAttribute('data-type'),
                    content: block.innerHTML
                }));
                
                const blob = new Blob([JSON.stringify(content, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'blocksuite-content.json';
                a.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // 格式化文本
        function formatText(type) {
            const selection = window.getSelection();
            const block = selection.focusNode?.closest('.block');
            if (block) {
                block.className = `block ${type}`;
                block.setAttribute('data-type', type);
            }
        }
        
        // 插入新块
        function insertBlock() {
            editor.insertNewBlock();
        }
        
        // 导出内容
        function exportContent() {
            editor.exportContent();
        }
        
        // 初始化编辑器
        const editor = new BlockSuiteEditor(document.getElementById('editor'));
        
        // 添加一些交互提示
        console.log('BlockSuite 编辑器已初始化！');
        console.log('使用技巧：');
        console.log('- 点击任意块开始编辑');
        console.log('- 按 Enter 创建新块');
        console.log('- 使用工具栏格式化文本');
        console.log('- 空块按 Backspace 删除');
    </script>
</body>
</html>
